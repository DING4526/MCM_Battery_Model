# ğŸ“ ä¸€ã€æ¨èé¡¹ç›®ç›®å½•

```
battery_sim/
â”‚
â”œâ”€â”€ main.py                # ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ config/               # æ‰€æœ‰â€œè¡¨æ ¼å‹å®šä¹‰â€
â”‚   â”œâ”€â”€ device.py         # ç¡¬ä»¶å‚æ•° + MC é‡‡æ ·
â”‚   â”œâ”€â”€ states.py         # çŠ¶æ€å‚æ•°è¡¨
â”‚   â”œâ”€â”€ scenarios.py      # daily profiles
â”‚
â”œâ”€â”€ core/                 # æ ¸å¿ƒç‰©ç†ä¸ç§¯åˆ†
â”‚   â”œâ”€â”€ power.py          # å­æ¨¡å—åŠŸè€—æ¨¡å‹
â”‚   â”œâ”€â”€ aging.py          # æ¸©åº¦ + è€åŒ–
â”‚   â”œâ”€â”€ integrator.py     # SOC æ•°å€¼ç§¯åˆ†
â”‚
â””â”€â”€ analysis/
    â”œâ”€â”€ montecarlo.py     # MC ä¸»å¾ªç¯
    â”œâ”€â”€ attribution.py   # èƒ½é‡ / çŠ¶æ€åˆ†è§£
    â””â”€â”€ sensitivity.py   # çµæ•åº¦
```

------

# ğŸ§± äºŒã€å„ç›®å½•èŒè´£ï¼ˆéå¸¸é‡è¦ï¼‰

æˆ‘æŒ‰ä½ åˆ—çš„æ¨¡å—ä¸€ä¸€å¯¹åº”ï¼š

------

## ğŸŸ¦ config/

è¿™æ˜¯ï¼š

> â€œä¸éšç®—æ³•å˜åŒ–çš„å®šä¹‰å±‚â€

### device.py

- æ ‡ç§°è®¾å¤‡å‚æ•°
- MC é‡‡æ ·è§„åˆ™

```
def sample_device():
```

------

### states.py

ä½ çš„å®Œæ•´çŠ¶æ€è¡¨ï¼š

```
STATE = {...}
```

+ï¼š

```
def get_state_params(state,system_mode=None):
```

------

### scenarios.py

daily è¡Œä¸ºåˆ†å¸ƒï¼š

```
def get_daily_profile(name):
```

------

------

## ğŸŸ¥ core/

è¿™æ˜¯ï¼š

> è¿ç»­ç‰©ç†ç³»ç»Ÿ

------

### power.py

```
screen_power()
cpu_power()
radio_power()
gps_power()
bg_power()
total_power()
```

------

### aging.py

```
effective_energy(G,T,FC,cycles)
```

------

### integrator.py

è¿™æ˜¯ heartï¼š

```
def simulate_day(profile,G,T,SOH0):
```

é‡Œé¢ï¼š

- çŠ¶æ€éå†
- åŠŸè€—è®¡ç®—
- aging ä¿®æ­£
- SOC ç§¯åˆ†
- energy logging

è¿”å›ï¼š

```
TTE, energy_by_state, energy_by_module
```

------

------

## ğŸŸ© analysis/

è¿™æ˜¯ï¼š

> åå¤„ç†å±‚ï¼ˆä¸æ”¹å˜ç‰©ç†ï¼‰

------

### montecarlo.py

```
def run_mc(N,scenario,user,system):
```

------

### attribution.py

```
energy_breakdown()
state_ablation()
```

------

### sensitivity.py

```
oat_sensitivity()
```

------

------

# â–¶ï¸ main.pyï¼ˆæ€»æ§ï¼‰

éå¸¸å¹²å‡€ï¼š

```
from analysis.montecarlo import run_mc
from analysis.attribution import energy_breakdown
from analysis.sensitivity import oat_sensitivity

TTE = run_mc(500,"Average","Heavy","battery_saver")

energy_breakdown(TTE)

oat_sensitivity()
```

------

# ğŸ§  ä¸‰ã€ä½ å…³å¿ƒçš„â€œæ‰€æœ‰æ¨¡å—æ˜¯å¦å®Œæ•´è¦†ç›–ï¼Ÿâ€

é€æ¡å¯¹ç…§ä½ åˆšæ‰æå‡ºçš„ï¼š

------

### âœ… Monte Carloï¼ˆè®¾å¤‡+ç¯å¢ƒï¼‰

â†’ config/device.py + analysis/montecarlo.py

------

### âœ… æ—¥å¸¸åœºæ™¯æ˜ å°„

â†’ config/scenarios.py

------

### âœ… ç”¨æˆ·ç­–ç•¥

â†’ montecarlo.py ä¸­è°ƒç”¨ policiesï¼ˆæˆ–ç›´æ¥åµŒï¼‰

------

### âœ… ç³»ç»Ÿç­–ç•¥

â†’ states.py ä¸­ get_state_params

------

### âœ… çŠ¶æ€æ˜ å°„

â†’ states.py

------

### âœ… åŠŸè€—æ•°å€¼è§£

â†’ core/power.py

------

### âœ… æ¸©åº¦ + è€åŒ–

â†’ core/aging.py

------

### âœ… SOC ç§¯åˆ†

â†’ core/integrator.py

------

### âœ… èƒ½é‡åˆ†è§£

â†’ analysis/attribution.py

------

### âœ… çŠ¶æ€åˆ†è§£

â†’ analysis/attribution.py

------

### âœ… çµæ•åº¦

â†’ analysis/sensitivity.py

------

âœ” å…¨éƒ¨è¦†ç›–
 âœ” å„è‡ªç‹¬ç«‹
 âœ” ä¸äº’ç›¸æ±¡æŸ“



# å››ã€å‚æ•°è®¾è®¡

| çŠ¶æ€          | ç‰©ç†/è¡Œä¸ºç‰¹å¾ | åŠŸè€—ç»“æ„ç¨³å®šæ€§ |
| ------------- | ------------- | -------------- |
| S0 Deep Idle  | æ¯å±ã€Doze    | æç¨³å®š         |
| S1 Light Idle | æ¯å±+åå°     | ç¨³å®š           |
| S2 Social     | è½»äº¤äº’        | ç¨³å®š           |
| S3 Web        | è¿ç»­æ»‘åŠ¨      | ç¨³å®š           |
| S4 Video      | é«˜å±å¹•+ä¸­ CPU | æç¨³å®š         |
| S5 Navigation | GPS+äº®å±      | æç¨³å®š         |
| S6 Gaming     | é«˜ CPU/GPU    | æç¨³å®š         |
| S7 Camera     | é«˜åŠŸè€—ä½†çŸ­    | ç¨³å®š           |

## 1ï¸âƒ£ å›ºå®šè®¾å¤‡å‚æ•°ï¼ˆå¯ MCï¼‰

```
DEVICE = {
    # Screen
    "A": 48.0,
    "p_u": 0.001,
    "P_base_60": 0.10,
    "P_off": 0.01,
    "kappa": 0.2,

    # CPU
    "P_cpu_idle": 0.1,
    "P_cpu_dyn": 2.0,

    # Radio
    "P_i": 0.1,
    "P_a": 0.9,
    "P_t": 0.6,
    "alpha_wifi": 0.85,
    "alpha_cell": 1.1,

    # GPS
    "P_gps": 0.15,

    # Background
    "P_bg_idle": 0.08,
    "P_bg_active": 0.30,

    # Battery
    "E0": 15.0,        # Wh
    "lambda_base": 4.19e-4,
    "k_FC": 8.77e-4,
    "k_T": 0.0417,
    "T_ref": 298.0
}
```

------

## 2ï¸âƒ£ çŠ¶æ€é©±åŠ¨å‚æ•°ï¼ˆä½ è¦çš„â€œå®Œæ•´è¯¦ç»†ç‰ˆâ€ï¼‰

```
STATE = {

"S0": {  # Deep Idle
 "screen": {"s":0},
 "cpu":{"u":0.03},
 "radio":{"Ri":0.9,"Ra":0.05,"Rt":0.05,"lambda":0.1,"delta":0},
 "gps":{"r":0},
 "bg":{"r":0.05}
},

"S1": {
 "screen":{"s":0},
 "cpu":{"u":0.1},
 "radio":{"Ri":0.7,"Ra":0.15,"Rt":0.15,"lambda":0.2,"delta":0.1},
 "gps":{"r":0},
 "bg":{"r":0.15}
},

"S2": {
 "screen":{"s":1,"u":0.3,"r":60},
 "cpu":{"u":0.25},
 "radio":{"Ri":0.3,"Ra":0.4,"Rt":0.3,"lambda":0.4,"delta":0.1},
 "gps":{"r":0.05},
 "bg":{"r":0.2}
},

"S3": {
 "screen":{"s":1,"u":0.45,"r":60},
 "cpu":{"u":0.35},
 "radio":{"Ri":0.3,"Ra":0.4,"Rt":0.3,"lambda":0.4,"delta":0.1},
 "gps":{"r":0},
 "bg":{"r":0.15}
},

"S4": {
 "screen":{"s":1,"u":0.7,"r":90},
 "cpu":{"u":0.5},
 "radio":{"Ri":0.2,"Ra":0.6,"Rt":0.2,"lambda":0.6,"delta":0.1},
 "gps":{"r":0},
 "bg":{"r":0.1}
},

"S5": {
 "screen":{"s":1,"u":0.6,"r":60},
 "cpu":{"u":0.4},
 "radio":{"Ri":0.1,"Ra":0.6,"Rt":0.3,"lambda":0.7,"delta":0.3},
 "gps":{"r":0.8},
 "bg":{"r":0.1}
},

"S6": {
 "screen":{"s":1,"u":0.8,"r":120},
 "cpu":{"u":0.9},
 "radio":{"Ri":0.4,"Ra":0.4,"Rt":0.2,"lambda":0.5,"delta":0},
 "gps":{"r":0},
 "bg":{"r":0.05}
},

"S7": {
 "screen":{"s":1,"u":0.7,"r":60},
 "cpu":{"u":0.6},
 "radio":{"Ri":0.3,"Ra":0.4,"Rt":0.3,"lambda":0.3,"delta":0.1},
 "gps":{"r":0},
 "bg":{"r":0.05}
}

}
```

ä»¥ä¸Šä¸ºç¤ºä¾‹